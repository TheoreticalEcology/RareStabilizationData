abline(-3,2,lwd=2)
plot(NA,NA,xlim=c(0,1),ylim=c(-3,3),xlab="relative abundance",ylab="log lambda",main="")
abline(h=0,col="grey",lwd=2)
abline(1,30,lwd=2)
abline(-3,30,lwd=2)
abline(3,-30,lwd=2)
abline(-1,-20,lwd=2)
abline(3,-2,lwd=2)
abline(-3,2,lwd=2)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Unbiased Hubbard Brook")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Unbiased Hubbard Brook")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Unbiased Hubbard Brook")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Unbiased Hubbard Brook")
stabilRA(hubbard2,"Unbiased Hubbard Brook")
View(hubbard)
View(hubbard2)
?round
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
View(hubbard)
stabilRA(hubbard2,"Unbiased Hubbard Brook")
stabilRA(hubbard,"Hubbard Brook")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard Brook")
stabilRA(hubbard2,"Hubbard Brook (unbiased)")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
fitN(log(hubbard[,4]))
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/GompertzFuns.r')
View(hubbard)
hubbard[hubbard<0]="NA"
View(hubbard)
fitN(log(hubbard[,5]))
fitGompertzSS(log(hubbard[,5]))
fitGompertzSS(log(as.numeric(hubbard[,5]))
)
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
fitGompertzSS(log(as.numeric(hubbard[,6])))
fitGompertzSS(log(as.numeric(hubbard[,7])))
fitGompertzSS(log(as.numeric(hubbard[,4])))
mean(log(as.numeric(hubbard[,4])),na.rm=T)
mean(log(as.numeric(hubbard[,5])),na.rm=T)
mean(log(as.numeric(hubbard[,6])),na.rm=T)
?mean
is.finite(log(as.numeric(hubbard[,5]))
)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/GompertzFuns.r')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
warnings()
View(hubbard2)
stabilRA(hubbard2,"Unbiased Hubbard")
stabilRA(hubbard2,"Unbiased Hubbard")
?cov
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Unbiased Hubbard")
?cov.test
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/GompertzFuns.r')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
abund=hubbard
sp_names=colnames(abund)[4:length(colnames(abund))]
#calculate observed growth rates:
#log lambda function
lambda=function(file) {
if(file[i+1,x]<=0 | file[i,x]<=0){
r=NA
}else{
r=log(file[i+1,x]/file[i,x])
}
return(r)
}
#data:
S=length(sp_names)
lastyear=max(abund[,1])
#calc relative abundance
relA=abund[,4:dim(abund)[2]]/abund[,3]
relA=relA[which(abund[,1]!=lastyear),]
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
relA=abund[,4:dim(abund)[2]]/abund[,3]
relA=abund[,4:dim(abund)[2]]/as.numeric(abund[,3])
relA=as.numeric(abund[,4:dim(abund)[2]])/as.numeric(abund[,3])
lambda=function(file) {
if(is.na(file[i+1,x]) | is.na(file[i,x])) {
r=NA
}else{
r=log(file[i+1,x]/file[i,x])
}
return(r)
}
relA=as.numeric(abund[,4:dim(abund)[2]])/as.numeric(abund[,3])
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
warning()
warnings()
is.finite(hubbard[,4:dim(hubbard)[2]])
is.finite(hubbard)
hubbard[,4]/hubbard[,3]
hubbard[,5]/hubbard[,3]
is.numeric(hubbard[,5])/hubbard[,3]
is.numeric(hubbard[,5])
as.numeric(hubbard[,5])/hubbard[,3]
relA=as.numeric(abund[,4:dim(abund)[2]])/abund[,3]
abund[,4:dim(abund)[2]]
matrix(abund[,4:dim(abund)[2]])
as.numeric(abund[,4:dim(abund)[2]])
as.matrix(abund[,4:dim(abund)[2]])
as.data.frame(abund[,4:dim(abund)[2]])
hubbard[is.na(hubbard)]=-99
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
View(hubbard)
hubbard[is.na(hubbard)]=-99
View(hubbard)
hubbard <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Birds/hubbard.txt")
View(hubbard)
stabilRA(hubbard,"Hubbard")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/GompertzFuns.r')
hubbard2=unbiasedNFD(hubbard)
log(1e300)
log(1e-300)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
stabilRA(hubbard2)
stabilRA(hubbard2,"Hubbard Brook (Unbiased)")
View(hubbard2)
?rnorm
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
fitN=function(y) {
fit_out=fitGompertzSS(y)
x=rep(NA,length(y))
e=rnorm(length(y)-1,0,sqrt(fit_out$sp2))
if(is.na(y[1])) x[1]=0 else x[1]=y[1]
for(t in 2:length(y)){
x[t]=fit_out$a + fit_out$c*x[t-1] + e[i-1]
}
N=exp(x)
return(N)
}
fitN(hubbard[,4])
fitN(log(hubbard[,4]))
fitN(log(hubbard[,5]))
fitN(log(hubbard[,6]))
View(hubbard)
fitN(log(hubbard[,6]))
fitN(log(hubbard[,6]))
fitN(log(hubbard[,6]))
fitN(log(hubbard[,6]))
fitN(log(hubbard[,7]))
fitN(log(hubbard[,8]))
fitN(log(hubbard[,9]))
fitN(log(hubbard[,10]))
fitN(log(hubbard[,11]))
fitN(log(hubbard[,12]))
fitN(log(hubbard[,13]))
fitN(log(hubbard[,14]))
fitN(log(hubbard[,15]))
fitN(log(hubbard[,16]))
fitN(log(hubbard[,17]))
fitN(log(hubbard[,18]))
fitGompertzSS(log(hubbard[,18]))
e=rnorm(42-1,0,sqrt(0.03108982))
e
max(-1,0)
max(1,0)
max(1+2,0)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
View(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard2,"Hubbard (Unbiased)")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/stabil_function_raw.R')
stabilRA(hubbard,"Hubbard")
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbell2=unbiasedNFD(hubbell)
hubbard2=unbiasedNFD(hubbard)
View(hubbard2)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
?dnorm
iFix=rep(FALSE,4),
iFix=rep(FALSE,4)
pFix=NA
?optim
hubbard <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Birds/hubbard.txt")
View(hubbard)
y=hubbard[,4]
y[y<0]=NA
fix(y)
mu=mean(y,na.rm=TRUE)
s2=var(y,na.rm=TRUE)
if (is.na(c)) c0=runif(nStart,-1.1,1.1) else c0=c
fix(`c0`)
nStart=50
a1=y[1],P1=10,nStart=50,a=NA,c=NA,sp2=NA,so2=NA
a1=y[1]
P1=10
a=NA
c=NA
sp2=NA
so2=NA
if (is.na(c)) c0=runif(nStart,-1.1,1.1) else c0=c
fix(`c0`)
if (is.na(a)) a0=rnorm(nStart,mean=mu*(abs(c0)<1)*(1-c0),sd=sqrt(s2)/10) else a0=NA
ds2=runif(nStart,.5,1.5)
if (is.na(sp2) & is.na(so2)) {
ap0=runif(nStart,0,1)
lsp20=log(s2*ds2*ap0)
lso20=log(s2*ds2*(1-ap0))
}
if (!is.na(sp2) & is.na(so2)) {
lso20=log((s2*ds2-sp2)*(s2*ds2>sp2) + (s2*ds2<sp2)*exp(runif(nStart,0,.5)))
lsp20=NA
}
if (is.na(sp2) & !is.na(so2)) {
lsp20=log((s2*ds2-so2)*(s2*ds2>so2) + (s2*ds2<so2)*exp(runif(nStart,0,.5)))
lso20=NA
}
# Specify which parameters to hold fixed during optimization
iFix=!is.na(c(a,c,sp2,so2))
iFix
pFix=c(a,c,log(sp2),log(so2))[iFix]
pFix
p=cbind(a=a0,c=c0,lsp2=lsp20,lso2=lso20)[,!iFix,drop=FALSE]
p
if (length(pOpt) + length(pFix) != 4 | sum(iFix)!= length(pFix)) stop("Number of parameters to estimate not correctly specified.")
pOpt=p[1,]
if (length(pOpt) + length(pFix) != 4 | sum(iFix)!= length(pFix)) stop("Number of parameters to estimate not correctly specified.")
p=rep(0,4)
p[!iFix]=pOpt
p[iFix]=pFix
a=p[1]
c=p[2]
sp2=exp(p[3])
so2=exp(p[4])
F=P1+so2
v=y[1]-a1
ll=log(dnorm(v,mean=0,sd=sqrt(F)))
for (i in 2:length(y)) {
a1=a+c*a1+c*P1/F*v
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
v=0
if (is.finite(y[i])) {
v=y[i]-a1
ll=ll+log(dnorm(v,mean=0,sd=sqrt(F)))
}
}
if(!is.finite(ll)) ll=-1e300
-ll
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/GompertzFuns.r')
hubbard <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Birds/hubbard.txt")
View(hubbard)
hubbard2=fitGompertzSS(log(hubbard[,5]))
hubbard2
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
findv(hubbard[,5],hubbard2)
warnings()
fit=hubbard2
y=hubbard[,5]
a=fit$a
c=fit$c
sp2=exp(fit$sp2)
so2=exp(fit$so2)
a1=y[1]
P1=10
F=P1+so2
v=y[1]-a1[1]
ll=log(dnorm(v,mean=0,sd=sqrt(F)))
for (i in 2:length(y)) {
a1=a+c*a1[i-1]+c*P1/F*v
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
v=0
if (is.finite(y[i])) {
v[i]=y[i]-a1[i]
ll=ll+log(dnorm(v,mean=0,sd=sqrt(F)))
}
}
if(!is.finite(ll)) ll=-1e300
-ll
a1
v
}
y
i
i=2
a1[i]=a+c*a1[i-1]+c*P1/F*v
a
c
P1
F
v
a1[i]=a+c*a1[i-1]+c*P1/F*v[i-1]
a1
a1[i-1]
a1=y[1]
a1
a1[1]
a1[1]=y[1]
a1
F=P1+so2
F
P1+so2
P1
fit$so2
P1=10
F=P1+so2
F
a=fit$a
c=fit$c
sp2=exp(fit$sp2)
so2=exp(fit$so2)
a1[1]=y[1]
P1=10
F=P1+so2
v[1]=y[1]-a1[1]
v
ll=log(dnorm(v[1],mean=0,sd=sqrt(F)))
i
a1[i]=a+c*a1[i-1]+c*P1/F*v[i-1]
a1
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
P1
F=P1+so2
if (is.finite(y[i])) {
v[i]=y[i]-a1[i]
ll=ll+log(dnorm(v[i],mean=0,sd=sqrt(F)))
}
if(!is.finite(ll)) ll=-1e300
-ll
a1
v
source('~/.active-rstudio-document')
findv(y,fit)
source('~/.active-rstudio-document')
findv(y,fit)
for (i in 2:length(y)) {
a1[i]=a+c*a1[i-1]+c*P1/F*v[i-1]
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
if (is.finite(y[i])) {
v[i]=y[i]-a1[i]
ll=ll+log(dnorm(v[i],mean=0,sd=sqrt(F)))
}
}
ll
v
ll=log(dnorm(v[1],mean=0,sd=sqrt(F)))
ll
source('~/.active-rstudio-document')
findv(y,fit)
y=log(hubbard[,5])
findv(y,fit)
exp(a1)
exp(a1)-hubbard[,5]
mean(exp(a1)-hubbard[,5])
mean(hubbard[,5])
hubbard5=hubbard[,5]
hubbard5[<0]=NA
hubbard5[hubbard5<0]=NA
y=log(hubard5)
y=log(hubbard5)
fit=fitGompertzSS(y)
fit
fix(hubbard5)
findv(y,fit)
exp(a1)
exp(a1)-hubbard5
mean(exp(a1)-hubbard5)
mean(exp(a1)-hubbard5,na.rm=T)
mean(hubbard5,na.rm=T)
exp(log(hubbard5)-v)
exp(v)
hubbard5-exp(log(hubbard5)-v)
mean(hubbard5-exp(log(hubbard5)-v))
mean(hubbard5-exp(log(hubbard5)-v),na.rm=T)
source('~/.active-rstudio-document')
findv(y,fit)
exp(log(hubbard5)-v)
mean(hubbard5-exp(log(hubbard5)-v),na.rm=T)
fit
source('~/.active-rstudio-document')
findv(y,fit)
ll=log(dnorm(v[1],mean=0,sd=sqrt(F)))
ll
i=2
a1=a+c*a1+c*P1/F*v[i-1]
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
if (is.finite(y[i])) {
v[i]=y[i]-a1
ll=ll+log(dnorm(v[i],mean=0,sd=sqrt(F)))
}
a1
a1=y[1]
a=fit$a
c=fit$c
sp2=fit$sp2
so2=fit$so2
a1=y[1]
P1=10
F=P1+so2
v[1]=y[1]-a1
ll=log(dnorm(v[1],mean=0,sd=sqrt(F)))
ll
a1=a+c*a1+c*P1/F*v[i-1]
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
if (is.finite(y[i])) {
v[i]=y[i]-a1
ll=ll+log(dnorm(v[i],mean=0,sd=sqrt(F)))
}
ll
i=3
a1=a+c*a1+c*P1/F*v[i-1]
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
if (is.finite(y[i])) {
v[i]=y[i]-a1
ll=ll+log(dnorm(v[i],mean=0,sd=sqrt(F)))
}
ll
is.finite(y[5])
y
is.finite(y[30])
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/fitv_function.R')
findv(y,fit)
P1=c^2*P1*(1-P1/F*is.finite(y[30]))+sp2
P1
for (i in 2:length(y)) {
a1=a+c*a1+c*P1/F*v[i-1]
P1=c^2*P1*(1-P1/F*is.finite(y[i-1]))+sp2
F=P1+so2
}
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/fitv_function.R')
findv(y,fit)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/fitv_function.R')
findv(y,fit)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/fitv_function.R')
findv(y,fit)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
#Get unbiased abundance estimates for a population time series
fitN=function(y) {
fit_out=fitGompertzSS(y)
v=findv(y,fit_out)$v
N=exp(y-v)
return(N)
}
fitN(hubbard5)
y
hubbard5
fitN(log(hubbard5)
)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
source('C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/unbiasedNFD_function.R')
hubbard2=unbiasedNFD(hubbard)
curlew <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Mammals/curlew.txt")
View(curlew)
curlew2=unbiasedNFD(curlew)
curlew2=unbiasedNFD(curlew)
INEEL <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Mammals/INEEL.txt")
View(INEEL)
INEEL2=unbiasedNFD(INEEL)
Ontario_rod <- read.delim("C:/Users/gmyenni/Dropbox/projects/niche4neutrality/RareStabilizationData/Mammals/Ontario_rod.txt")
View(Ontario_rod)
Ontario_rod2=unbiasedNFD(Ontario_rod)
fitGompertzSS(log(Ontario_rod[,5])
)
ont5=Ontario_rod[,5]
ont5[ont5<0]=NA
ont5=Ontario_rod[,5]
ont5[ont5<0]=0
fitGompertzSS(log(Ontario_rod[,5])
)
fitGompertzSS(log(ont5))
